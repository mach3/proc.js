/*!
 * Proc.js
 * -------
 * Run proccesses by something
 * 
 * @version 0.0.0
 * @author mach3 <http://github.com/mach3>
 * @url http://github.com/mach3/proc.js
 * @license MIT License
 * @require jQurery.js
 */
!function(a){var b=function(){arguments.length&&this.append.apply(this,arguments)};a.extend(b.prototype,{states:[],state:-1,df:null,append:function(){var b=this;return a.each(Array.prototype.slice.call(arguments),function(c,d){switch(a.type(d)){case"array":b.append.apply(b,d);break;case"function":b.states.push(d)}}),this},process:function(){var b,c,d=this;if(c=this.states[++this.state],"function"===a.type(c))switch(b=c.call(this),!0){case b===!1:return this.df.reject();case"undefined"===a.type(b)||b===!0:return this.process();case"delay"===b.type:return setTimeout(function(){d.process.call(d)},b.time);case"deferred"===b.type:return b.done(a.proxy(this.process,this)).fail(function(){d.df.reject()})}return this.states.length===this.state?this.df.resolve():void 0},run:function(){return this.reset(),this.process(),this.df},reset:function(){return this.state=-1,this.df=new a.Deferred,this},deferred:function(){var b=a.Deferred();return b.type="deferred",b},delay:function(a){return{type:"delay",time:a}}}),a.Chain=b}(jQuery),function(a){var b=function(){this.init.apply(this,arguments)};a.extend(b.prototype,{defaults:{duration:0,interval:10},options:null,states:null,_states:null,startTime:null,timer:null,working:!1,df:null,init:function(a){this.config(this.defaults),a&&this.config(a),this._states=[]},config:function(b){return this.options||(this.options={}),a.extend(this.options,b),this},get:function(a){return this.options[a]},append:function(){var b,c=this;switch(b=Array.prototype.slice.call(arguments),!0){case"object"===a.type(b[0]):return this._states.push(b[0]),this;case"numer"===a.type(b[0])&&"function"===a.type(b[1]):return this._states.push({time:b[0],callback:b[1]}),this;case"array"===a.type(b[0]):return a.each(b[0],function(a,b){c.append(b)}),this}return this},reset:function(){return this._states.sort(function(a,b){return b.time-a.time}),this.states=a.extend([],this._states),this.startTime=this.now(),this.df=a.Deferred(),this},run:function(){return this.reset(),this.work(!0),this.process(),this.df},now:function(){return(new Date).getTime()},work:function(b){switch(a.type(b)){case"undefined":return this.working;case"boolean":return this.working=b,this.working}},process:function(){var b,c,d,e;if(this.work()){if(b=this.now()-this.startTime,c=this.states.length,e=this.get("duration"),e&&b>=e||!this.states.length)return void this.df.resolve();for(;c--;)if(d=this.states[c],d.time<=b){if(!1===d.callback(this))return this.df.reject();this.states.pop()}this.timer=setTimeout(a.proxy(this.process,this),this.get("interval"))}},stop:function(){return clearTimeout(this.timer),this.timer=null,this.work(!1),this.df.reject(),this}}),a.Frames=b}(jQuery),function(a){var b=function(){this.init.apply(this,arguments)};a.extend(b.prototype,{EVENT_STATE:"state",defaults:{useAnimationFrame:!0},stateDefaults:{top:0,hover:null,down:null,up:null},win:a(window),options:null,states:[],running:!1,scrollTop:0,dispatcher:null,init:function(b){this.options={},this.config(this.defaults),b&&this.config(b),this.dispatcher=a({}),this.onFrame=a.proxy(this.onFrame,this),this.onScroll=a.proxy(this.onScroll,this)},config:function(b){return a.extend(this.options,b),this},get:function(a){return this.options[a]},on:function(){return this.dispatcher.on.apply(this.dispatcher,arguments),this},off:function(){return this.dispatcher.off.apply(this.dispatcher,arguments),this},append:function(){var b=this;return a.each(arguments,function(c,d){return"array"===a.type(d)?void b.append.apply(b,d):void b.states.push(a.extend({},this.stateDefaults,d))}),this},run:function(b){switch(this.running=!0,b=void 0===b?!0:b,a.type(b)){case"boolean":this.scrollTop=b?this.win.scrollTop():this.scrollTop;break;case"number":this.scrollTop=b}return this.get("useAnimationFrame")&&"requestAnimationFrame"in window?this.onFrame():(this.win.on("scroll",this.onScroll),this.win.trigger("scroll")),this},stop:function(){return this.running=!1,this},process:function(b){var c,d,e,f,g;for(f=!1,c=this.states.length,e=function(b,c){"function"===a.type(b[c])&&(!1===b[c]()&&(b[c]=null),f=!0)};c--;)g=!1,d=this.states[c],d.top<this.scrollTop&&d.top>=b?(e(d,"up"),g=!0):d.top>this.scrollTop&&d.top<=b&&(e(d,"down"),g=!0),g&&e(d,"hover");f&&this.dispatcher.trigger(this.EVENT_STATE),this.scrollTop=b},onFrame:function(){this.running&&(this.process(this.win.scrollTop()),window.requestAnimationFrame(this.onFrame))},onScroll:function(){this.running||this.win.off(this.onScroll),this.process(this.win.scrollTop())}}),a.Scroll=b}(jQuery),function(a){a.proc=function(b,c){switch(c=c||{},b){case"chain":return new a.Chain(c);case"frames":return new a.Frames(c);case"scroll":return new a.Scroll(c)}}}(jQuery);